<html>
<head>
    <meta charset=utf-8>
    <title>Earth Model</title>
    <style>
        body { margin: 0; }
        canvas { width: 100%; height: 100% }
    </style>
</head>
<body>
   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-geo@3"></script>
    <script> 
    //change if it is night or day
    const night = false;
    //constants 
    const GLOBE_RADIUS = 0.5;
    const CURVE_MIN_ALTITUDE = 2;
    const CURVE_MAX_ALTITUDE = 5;
    const DEGREE_TO_RADIAN = Math.PI / 180;
    var geoInterpolate = d3.geoInterpolate;
    function clamp(num, min, max) {
  return num <= min ? min : (num >= max ? max : num);
}
function coordinateToPosition(lat, lng, radius) {
  const phi = (90 - lat) * DEGREE_TO_RADIAN;
  const theta = (lng + 180) * DEGREE_TO_RADIAN;

  return new THREE.Vector3(
    - radius * Math.sin(phi) * Math.cos(theta),
    radius * Math.cos(phi),
    radius * Math.sin(phi) * Math.sin(theta)
  );
}
function getSplineFromCoords(coords) {
  const startLat = coords[0];
  const startLng = coords[1];
  const endLat = coords[2];
  const endLng = coords[3];

  // start and end points
  const start = coordinateToPosition(startLat, startLng, GLOBE_RADIUS);
  const end = coordinateToPosition(endLat, endLng, GLOBE_RADIUS);
  
  // altitude
  const altitude = clamp(start.distanceTo(end) * .75, CURVE_MIN_ALTITUDE, CURVE_MAX_ALTITUDE);
  
  // 2 control points
  const interpolate = geoInterpolate([startLng, startLat], [endLng, endLat]);
  const midCoord1 = interpolate(0.25);
  const midCoord2 = interpolate(0.75);
  const mid1 = coordinateToPosition(midCoord1[1], midCoord1[0], GLOBE_RADIUS + altitude);
  const mid2 = coordinateToPosition(midCoord2[1], midCoord2[0], GLOBE_RADIUS + altitude);

  return {
    start,
    end,
    spline: new THREE.CubicBezierCurve3(start, mid1, mid2, end)
  };
}
    //Scene Setup
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

      var renderer = new THREE.WebGLRenderer();
      renderer.setSize( 1920  , 1080 );
      document.body.appendChild( renderer.domElement );

     var corecube = new THREE.SphereGeometry(1.7, 32, 32);
     var corecubeMaterial = new THREE.MeshPhongMaterial();
     var texture = night ? 'images/earthlights10k.jpg' : 'images/earthmap10k.jpg';
     corecubeMaterial.map = new THREE.TextureLoader().load(texture);
     corecubeMaterial.bumpMap   = new THREE.TextureLoader().load('images/earthbump10k.jpg');     
     corecubeMaterial.bumpScale = 0.05;
     
     
     
     var corecubeMesh = new THREE.Mesh( corecube, corecubeMaterial );
     scene.add( corecubeMesh );    
     //light
     var light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(0,3,5);
    scene.add(light);
     
      //wirecube
      var wirecube = new THREE.SphereGeometry( 2, 20,20 );
      var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } )
      var cube = new THREE.Mesh( wirecube, material );
      

      //convert into wireframe 
      var wireframe = new THREE.WireframeGeometry( wirecube ); 
      let line = new THREE.LineSegments( wireframe );
					line.material.opacity = 1;
					line.material.transparent = true;
      scene.add( line );
      camera.position.z = 3;
      //create point to point curve
     
      const group = new THREE.Group();
      let newcords = [[15,0],[28,6],[10,10],[20,20]];
      for(let i=0; i < newcords.length; i++){
        console.log(newcords[i]);
        let prev = i == 0 ? 1 : i-1;
        let cords = [newcords[prev][0],newcords[prev][1],newcords[i][0],newcords[i][1]];
        let spline = getSplineFromCoords(cords);
        console.log(cords,spline);
        /*let curve1 = new THREE.TubeGeometry(spline.spl, 50, 0.1, 8, false);
        let curve1mesh = new THREE.Mesh(curve1, new THREE.MeshBasicMaterial({color: 0xf56042}));
        scene.add(curve1mesh);*/
        let curvegeo = new THREE.Geometry();
        curvegeo.vertices = spline.spline.getPoints(50);
        let curve1 = new THREE.Line(curvegeo, new THREE.LineBasicMaterial({color: 0xf56042}));
        group.add(curve1);	
      }
      scene.add(group);



//animations
      var animate = function () {
	    requestAnimationFrame( animate );

      corecubeMesh.rotation.y += 0.001;
      line.rotation.y += 0.001;
      group.rotation.y += 0.001;
      renderer.render( scene, camera );
      };
      corecubeMesh.rotation.x += 0.5;

      animate();
      //renderer.setClearColor(0xEEEEEE);

          </script>
    </script>
</body>
</html>